<!DOCTYPE html>
<html>
  <head>
    <title>Project</title>
    <script src='https://cdn.staticfile.org/jquery/3.5.1/jquery.js'></script>
    <script src='https://cdn.staticfile.org/popper.js/2.8.4/umd/popper.js'></script>
    <script src='https://cdn.staticfile.org/twitter-bootstrap/4.6.0/js/bootstrap.js'></script>
    <script src='../assets/main.js'></script>
    <link rel='stylesheet' href='https://cdn.staticfile.org/twitter-bootstrap/4.6.0/css/bootstrap.css'>
    <link rel='stylesheet' href='../assets/main.css'>
  </head>
  <body class='bg-dark text-white text-center'>
    <header class='header text-left p-2'>
      <a href='..'>
        <img src='../assets/backarrow.png' alt='back' height='40'>
      </a>
    </header>
    <main class='container'>
      <section class='main'>
        <h1>View Project</h1>
        <span id='name'>Loading...</span>
      </section>
      <hr>
      <section>
        <div class='mx-auto alert alert-warning' id='loading'>
          <span class='spinner-border'></span><br>
          Loading project information...<br>
          Please wait for a while.
        </div>
        <div class='mx-auto alert alert-danger' id='error' style='display: none'>
          Module not found.<br>
          Please go back for more projects available.
        </div>
        <div id='info' style='display: none;'>
          <span id='desc'></span><br>
          <span id='version'></span>
          <div class='row mt-3'>
            <div class='col-6'>
              <span>Project URLs:</span>
              <ul class='list-group mt-3' id='urls'>
              </ul>
            </div>
            <div class='col-6'>
              <span>MD5 Hashes:</span>
              <ul class='list-group mt-3' id='hashes'>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer class='footer bg-dark'>
      <div class='container'>
        <hr>
        <div class='row mb-2'>
          <div class='col-6 p-2'>
            <a href='/about.html'>About</a>
          </div>
          <div class='col-6 p-2'>
            <span>This site is mainteined by <a href='https://github.com/origamizyt'>origamizyt</a>.</span><br>
            <span>Email: <a href='mailto:zhaoyitong18@163.com'>zhaoyitong18@163.com</a></span>
          </div>
        </div>
      </div>
    </footer>
    <script>
      let project = null;
      function toggleLoading(show) {
        if (show) $("#loading").show();
        else $("#loading").hide();
      }
      function toggleError(show) {
        if (show) $("#error").show();
        else $("#error").hide();
      }
      let name = tools.parameters()['name'];
      $(() => {
        toggleLoading(true);
        $.ajax("index.json", {
          method: 'GET',
          success(data) {
            toggleLoading(false);
            for (let p of data){
              if (p.projectName === name){
                project = p;
                break;
              }
            }
            if (project === null){
              toggleError(true);
            }
            else updateProject()
          }
        })
      });
      function updateProject(){
        $("#name").text(project.projectName);
        $("#desc").text("Description: " + project.description);
        $("#version").text("Version: " + project.version);
        for (let alias in project.projectUrls){
          let url = project.projectUrls[alias];
          let li = document.createElement("li");
          li.className = "list-group-item bg-secondary";
          let link = document.createElement("a");
          link.href = url;
          link.textContent = alias;
          li.appendChild(link);
          $("#urls").append(li);
        }
        for (let file in project.integrity){
          let hash = project.integrity[file];
          let li = document.createElement("li");
          li.className = "list-group-item bg-secondary";
          let span = document.createElement("span");
          span.textContent = `${file}: ${hash}`;
          li.appendChild(span);
          li.appendChild(document.createElement("br"));
          let code = document.createElement("code");
          code.className = "mono";
          code.textContent = `CertUtil -hashfile ${file} MD5`;
          li.appendChild(code);
          $("#hashes").append(li);
        }
        $("#info").show()
      }
    </script>
  </body>
</html>